!function(exports,global){global["true"]=exports,function(){"use strict";angular.module("app",[])}(),function(){"use strict";function APIWrapper($window,$q){this.fetch=function(url){var connection,onValue;return $q(function(resolve,reject){connection=new $window.Firebase(url),onValue=connection.on("value",function(snapshot){resolve(snapshot),connection.off("value",onValue)},reject)})},this.disconnect=function(){$window.Firebase.goOffline()}}APIWrapper.$inject=["$window","$q"],angular.module("app").service("APIWrapper",APIWrapper)}(),function(){"use strict";function KeyHandler(){var map={};this.on=function(_map){return map=angular.extend(map,_map),function(e){e.which in map&&(e.preventDefault(),map[e.which]())}},this.off=function(){e.which in map&&delete map[e.which]}}angular.module("app").service("KeyHandler",KeyHandler)}(),function(){"use strict";function TopStories($q,APIWrapper,URLProvider){function fetchTop(onStory,onDone,onError){APIWrapper.fetch(URLProvider.top()).then(function(snapshot){var promises=[];angular.forEach(snapshot.val(),function(id){var promise=$q(function(resolve){fetchStory(id,resolve)});promise.then(onStory),promises.push(promise)}),$q.all(promises).then(onDone).catch(onError)}).catch(onError)}function fetchStory(id,onStory){APIWrapper.fetch(URLProvider.item(id)).then(function(snapshot){var story=snapshot.val();story.date=new Date(1e3*story.time),story.text&&(story.url=URLProvider.view(story.id)),onStory(story)})}this.each=function(onStory){return $q(function(resolve,reject){fetchTop(function(story){onStory(story)},resolve,reject)})},this.disconnect=function(){APIWrapper.disconnect()}}TopStories.$inject=["$q","APIWrapper","URLProvider"],angular.module("app").service("TopStories",TopStories)}(),function(){"use strict";function URLProvider(){var baseAPI="https://hacker-news.firebaseio.com/v0/",baseHN="https://news.ycombinator.com/";this.item=function(id){return baseAPI+"item/"+id},this.top=function(){return baseAPI+"topstories"},this.view=function(id){return baseHN+"item?id="+id},this.vote=function(id){return baseHN+"vote?for="+id+"&dir=up&whence=news"}}angular.module("app").service("URLProvider",URLProvider)}(),function(){"use strict";function domain(){return function(url){var a=document.createElement("a");return a.href=url,a.hostname}}angular.module("app").filter("domain",domain)}(),function(){"use strict";function TopStoriesCtrl($scope,$window,TopStories,KeyHandler){$scope.index=-1,$scope.status="Loading",$scope.stories=[],TopStories.each(function(story){$scope.stories.push(story)}).then(function(){TopStories.disconnect()}).catch(function(){$scope.status="Error loading stories",console.log("The API returned an error")}),$scope.keyHandler=KeyHandler.on({13:function(){$scope.index>=0&&($window.location.href=$scope.filtered[$scope.index].url)},38:function(){$scope.index=Math.max(0,$scope.index-1)},40:function(){$scope.index=Math.min($scope.filtered.length-1,$scope.index+1)}}),$scope.$watch("index",function(){var selector,element;$scope.index>=0&&(selector=".story:nth-of-type("+($scope.index+1)+")",element=$window.document.querySelector(selector),$window.scrollTo(0,element.offsetTop-$window.innerHeight/2))})}TopStoriesCtrl.$inject=["$scope","$window","TopStories","KeyHandler"],angular.module("app").controller("TopStoriesCtrl",TopStoriesCtrl)}()}({},function(){return this}());
//# sourceMappingURL=app.min.js.map